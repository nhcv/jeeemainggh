<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JEE PYQ MCQ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    #question {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    #options button {
      display: block;
      margin: 5px auto;
      padding: 10px;
      width: 100%;
      max-width: 300px;
    }
    #timer {
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
    #navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    #navigation button {
      padding: 10px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #navigation button:hover {
      background-color: #218838;
    }
    #solution {
      margin-top: 10px;
      color: blue;
    }
    #show-solution {
      display: inline-block;
      margin: 10px auto;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 50px;
      padding: 8px 20px;
      font-size: 14px;
      cursor: pointer;
    }
    #show-solution:hover {
      background-color: #0056b3;
    }
    .center {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #auth-section {
      text-align: center;
      margin-bottom: 20px;
    }
    #auth-section button {
      padding: 8px 12px;
      margin: 5px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
    }
    #bookmark-btn {
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 10px;
    }
  </style>
</head>
<body>
<div id="auth-section">
  <span id="user-info"></span><br />
  <button id="google-login-btn">Login with Google</button>
  <button id="email-login-btn">Login with Email</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<div id="question">Loading question...</div>

<div class="center">
  <button id="show-solution" onclick="showSolution()">Show Solution</button>
</div>

<div id="options"></div>

<div id="timer">Time Taken: 00:00:00</div>

<div class="center">
  <button id="bookmark-btn" title="Bookmark">ðŸ”–</button>
</div>

<div id="navigation">
  <button onclick="prevQuestion()">Previous</button>
  <button onclick="nextQuestion()">Next</button>
</div>

<div id="solution" style="display:none;"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase Config (Replace with your actual config)
  const firebaseConfig = {
    apiKey: "AIzaSyC3xGuGQQVDCuo4PmUdu5CGoHg6HCOAJAc",
    authDomain: "physicsgrab-8b59e.firebaseapp.com",
    projectId: "physicsgrab-8b59e",
    storageBucket: "physicsgrab-8b59e.appspot.com",
    messagingSenderId: "903844335874",
    appId: "1:903844335874:web:ec7b57d7aa7c9df31b721b",
    measurementId: "G-1VWPWMD9F6"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  let currentUser = null;

  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      document.getElementById("user-info").textContent = `Hi, ${user.email}`;
      document.getElementById("google-login-btn").style.display = "none";
      document.getElementById("email-login-btn").style.display = "none";
      document.getElementById("logout-btn").style.display = "inline-block";
    } else {
      document.getElementById("user-info").textContent = "Not logged in";
      document.getElementById("google-login-btn").style.display = "inline-block";
      document.getElementById("email-login-btn").style.display = "inline-block";
      document.getElementById("logout-btn").style.display = "none";
    }
  });

  document.getElementById("google-login-btn").onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => auth.signInWithPopup(provider))
      .then(() => {
        alert("Login successful!");
        window.location.reload();
      })
      .catch(error => alert("Login failed: " + error.message));
  };

  document.getElementById("email-login-btn").onclick = () => {
    const email = prompt("Enter your email:");
    const password = prompt("Enter your password:");
    if (!email || !password) return alert("Email and password required.");

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => auth.signInWithEmailAndPassword(email, password))
      .then(() => {
        alert("Login successful!");
        window.location.reload();
      })
      .catch(error => {
        if (error.code === 'auth/user-not-found') {
          if (confirm("No user found. Sign up with this email?")) {
            return auth.createUserWithEmailAndPassword(email, password)
              .then(() => {
                alert("Signup successful!");
                window.location.reload();
              });
          }
        } else {
          alert("Login failed: " + error.message);
        }
      });
  };

  document.getElementById("logout-btn").onclick = () => {
    auth.signOut().then(() => {
      alert("Logged out");
      window.location.reload();
    });
  };

  document.getElementById("bookmark-btn").onclick = () => {
    if (!currentUser) {
      alert("Please login to bookmark questions.");
      return;
    }
    const userRef = db.collection("users").doc(currentUser.uid);
    userRef.set({ bookmarks: firebase.firestore.FieldValue.arrayUnion(currentIndex) }, { merge: true })
      .then(() => alert("Bookmarked!"))
      .catch(console.error);
  };

  const questions = [
    { question: "Q1: Example?", options: ["A", "B","C","D"], answer: "A", solution: "Sample solution." },
    { question: "Q2: Example?", options: ["C", "D", "E", "F"], answer: "C", solution: "Another solution." }
  ];

  let currentIndex = 0;
  let timer = 0;
  let interval = null;
  let answered = false;

  function formatTime(seconds) {
    const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
    const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
    const secs = String(seconds % 60).padStart(2, '0');
    return `${hrs}:${mins}:${secs}`;
  }

  function startTimer() {
    timer = 0;
    interval = setInterval(() => {
      timer++;
      document.getElementById("timer").textContent = `Time Taken: ${formatTime(timer)}`;
    }, 1000);
  }

  function showQuestion() {
    const q = questions[currentIndex];
    document.getElementById("question").textContent = q.question;
    const container = document.getElementById("options");
    container.innerHTML = "";
    q.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.onclick = () => selectOption(btn);
      container.appendChild(btn);
    });
    clearInterval(interval);
    startTimer();
    answered = false;
    document.getElementById("solution").style.display = "none";
    document.getElementById("solution").innerHTML = "";
    document.getElementById("show-solution").style.display = "inline-block";
  }

  function selectOption(btn) {
    if (answered) return;
    answered = true;
    clearInterval(interval);
    const q = questions[currentIndex];
    const buttons = document.querySelectorAll("#options button");
    if (btn.textContent === q.answer) {
      btn.style.backgroundColor = "green";
    } else {
      btn.style.backgroundColor = "red";
      buttons.forEach(b => {
        if (b.textContent === q.answer) b.style.backgroundColor = "green";
      });
    }
  }

  function showSolution() {
    if (!answered) {
      answered = true;
      clearInterval(interval);
      document.querySelectorAll("#options button").forEach(btn => {
        if (btn.textContent === questions[currentIndex].answer) btn.style.backgroundColor = "green";
        btn.onclick = null;
      });
    }
    document.getElementById("solution").innerHTML = questions[currentIndex].solution;
    document.getElementById("solution").style.display = "block";
    document.getElementById("show-solution").style.display = "none";
  }

  function nextQuestion() {
    if (currentIndex < questions.length - 1) {
      currentIndex++;
      showQuestion();
    }
  }

  function prevQuestion() {
    if (currentIndex > 0) {
      currentIndex--;
      showQuestion();
    }
  }

  showQuestion();
</script>
</body>
</html>